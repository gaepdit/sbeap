@using Microsoft.AspNetCore.Authorization
@using Sbeap.AppServices.Permissions
@using Sbeap.WebApp.Platform.Settings
@inject IAuthorizationService AuthorizationService
@{
    var apiKey = ApplicationSettings.RaygunSettings.ApiKey;
    if (string.IsNullOrEmpty(apiKey)) return;
    var isLoggedIn = (await AuthorizationService.AuthorizeAsync(User, PolicyName.LoggedIn)).Succeeded;
    var identifier = isLoggedIn ? null : User.Identity?.Name;
    var environment = Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT") ?? "unknown";
}

<script type="text/javascript">
  !function(a,b,c,d,e,f,g,h){a.RaygunObject=e,a[e]=a[e]||function(){
  (a[e].o=a[e].o||[]).push(arguments)},f=b.createElement(c),g=b.getElementsByTagName(c)[0],
  f.async=1,f.src=d,g.parentNode.insertBefore(f,g),h=a.onerror,a.onerror=function(b,c,d,f,g){
  h&&h(b,c,d,f,g),g||(g=new Error(b)),a[e].q=a[e].q||[],a[e].q.push({
  e:g})}}(window,document,"script","//cdn.raygun.io/raygun4js/raygun.min.js","rg4js");
</script>
<script>
    rg4js('apiKey', '@apiKey');
    rg4js('enableCrashReporting', true);
    rg4js('withTags', ['@environment']);
    @if (identifier is not null)
    {
        @:rg4js('setUser', {isAnonymous: false, identifier: '@identifier'});
    }
</script>
<environment names="Production"><script>rg4js('enablePulse', true);</script></environment>
